# 5-3. 패키지

## 패키지란 무엇인가?
패키지는 도트(.)를 사용하여 파이썬 모듈을 계층적으로 관리할 수 있게 해준다. 예를 들어 모듈 이름이 A.B인 경우에 A는 패키지 이름이 되고, B는 A패키지의 B모듈이 된다.  
  
즉 패키지는 모듈을 여러개 모아놓은 것이라고 할 수 있다.
> 파이썬에서 모듈은 하나의 .py 파일이다.
  
파이썬 패키지는 디렉터리와 파이썬 모듈로 이루어지며 구조는 다음과 같다.
  
*가상의 game패키지 예*
```
game/
    __init__.py
    sound/
        __init__.py
        echo.py
        wav.py
    graphic/
        __init__.py
        screen.py
        render.py
    play/
        __init__.py
        run.py
        test.py
```
game, sound, graphic, play는 디렉터리이며, 확장자가 .py인 파일은 파이썬 모듈이다.   
game 디렉터리가 이 패키지의 루트 디렉터리이고 sound, graphic, play는 서브 디렉터리이다.  
  
간단한 파이썬 프로그램이 아니라면 이렇게 패키지 구조로 파이썬 프로그램을 만드는 것이 공동 작업이나 유지 보수 등 여러 면에서 유리하다. 또한 패키지 구조로 모듈을 만들면 다른 모듈과 이름이 겹쳐도 더 안전하게 사용할 수 있다.

## 패키지 만들기
**패키지 기본 구성 요소 준비하기**
  
1. `C:/doit` 디렉터리 밑에 game 및 기타 서브 디렉터리를 생성하고 .py 파일들을 다음과 같이 만들어 보자
```
C:/doit/game/__init__.py
C:/doit/game/sound/__init__.py
C:/doit/game/sound/echo.py
C:/doit/game/graphic/__init__.py
C:/doit/game/graphic/render.py
```
  
2. 각 디렉터리에 `__init__.py` 파일을 만들어 놓기만 하고 내용은 일단 비워 둔다.
  
3. echo.py 파일은 다음과 같이 만든다.
``` python
# echo.py
def echo_test():
    print("echo")
```
  
4. render.py 파일은 다음과 같이 만든다.
``` python
# render.py
def render_test():
    print("render")
```

## 패키지 안의 함수 실행하기

패키지를 사용해 echo.py 파일의 echo_test 함수를 실행해 보자. 패키지 안의 함수를 실행하는 방법은 3가지가 있다.
  
1. echo 모듈(echo.py 파일)을 import하여 실행 
``` python
>>> import game.sound.echo
>>> game.sound.echo.echo_test()
echo
```

2. echo 모듈이 있는 디렉터리까지를 from ... import하여 실행
``` python
>>> from game.sound import echo
>>> echo.echo_test()
echo
```

3. echo 모듈의 echo_test 함수를 직접 import하여 실행
``` python
>>> from game.sound.echo import echo_test
>>> echo_test()
echo
```
  
하지만 다음과 같이 echo_test 함수를 사용하는 것은 불가능하다.
  
> ※ 다음 예제는 반드시 파이썬 인터프리터를 종료하고 다시 실행해야 한다.
  
```python
>>> import game
>>> game.sound.echo.echo_test()
```
import game을 수행하면 game 디렉터리의 `__init__.py`에 정의한 것만 참조할 수 있다.
  
```python
>>> import game.sound.echo.echo_test
```
도트 연산자(.)를 사용해서 import a.b.c 처럼 import할 때 가장 마지막 항목 c는 반드시 모듈 또는 패키지여야만 한다.

## __init__.py의 용도

이 파일은 해당 디렉터리가 패키지의 일부임을 알려주는 역할을 한다.  
패키지에 포함된 디렉터리(game, sound, graphic 등)에 `__init__.py` 파일이 없다면 패키지로 인식되지 않는다.
  
> ※ python3.3 버전부터는 `__init__.py` 파일이 없어도 패키지로 인식한다. 하지만 하위 버전 호환을 위해 `__init__.py` 파일을 생성하는 것이 안전한 방법이다.  

* `__all__` 변수의 설정

```python
>>> from game.sound import *
>>> echo.echo_test()
Traceback (most recent call last):
    File "<stdin>", line 1, in <module>
NameError: name 'echo' is not defined
```
game.sound 패키지에서 모든 것(`*`)을 import하였으므로 echo 모듈을 사용할 수 있어야 할 것 같은데 echo라는 이름이 정의되지 않았다는 NameError가 발생한다.
  
이렇게 특정 디렉터리의 모듈을 `*`를 사용하여 import할 때에는 다음과 같이 해당 디렉터리의 `__init__.py` 파일에 `__all__` 변수를 설정하고 import할 수 있는 모듈을 정의해 주어야 한다.

```
# C:/doit/game/sound/__init__.py
__all__ = ['echo']
```

여기서 `__all__`이 의미하는 것은 sound 디렉터리에서 * 기호를 사용하여 import할 경우 이곳에 정의된 `echo` 모듈만 import된다는 의미이다.
  
> ※ from game.sound.echo import * 는 `__all__`과 상관없이 무조건 import된다.  
> from a.b.c import * 에서 from의 마지막 항목인 c가 모듈인 경우!
  
위와 같이 `__init__.py` 파일을 변경한 후 위 예제를 수행하면 원하던 결과가 출력되는 것을 확인할 수 있다.
``` python
>>> from game.sound import *
>>> echo.echo_test()
echo
```


